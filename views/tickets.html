{{define "tickets"}}
{{if .Error}}
	<div class="alert alert-danger">{{.Error}}</div><p>
{{end}}
<div class="panel panel-default">
	<div class="panel-heading" style="background-color: #222; color: #ffffff;">
		<h4 class="panel-title">
			<a data-toggle="collapse" data-parent="#accordion" href="#collapse-info">Ticket Information</a>
		</h4>
	</div>
	<div id="collapse-info" class="panel-collapse collapse in">
		<div class="panel-body" style="background-color: #333; color: #ffffff;">
			<table class="table table-condensed">
				<tr>
					<td style="border: none;"><span style="font-size: large;"><b>P2SH Address:</b></span></td>
					<td style="border: none;">{{ .User.MultiSigAddress }}</td>
				</tr>
				<tr>
					<td style="border: none;"><span style="font-size: large;"><b>Redeem Script:</b></span></td>
					<td style="border: none; overflow: hidden; max-width: 450px; word-wrap: break-word;">{{ .User.MultiSigScript }}</b>
				</tr>
			</table>
		</div>
	</div>
</div>
<div class="panel panel-default">
	<div class="panel-heading" style="background-color: #222; color: #ffffff;">
		<h4 class="panel-title">
			<a data-toggle="collapse" data-parent="#accordion" href="#collapse-list">Ticket List</a>
		</h4>
	</div>
	<div id="collapse-list" class="panel-collapse collapse {{if .Tickets}}in{{end}}">
		<div class="panel-body" style="background-color: #333; color: #ffffff;">

			{{if not .Tickets}}
			<p><span style="font-size: larger;"><b>No tickets.</b></span></p>
			{{end}}
			{{if .Tickets}}
			<table id="tickets" class="table table-condensed">
			<thead>
				<tr>
					<th>Ticket</th>
					<th>Explore</th>
					<th>Pool Control</th>
					<th>Votebits</th>
				</tr>
			</thead>
			<tfoot>
				<tr>
					<th>Ticket</th>
					<th>Explore</th>
					<th>Pool Control</th>
					<th>Votebits</th>
				</tr>
			</tfoot>
			<tbody>
			{{ range $i, $data := .Tickets }}<tr>
				<td>{{$data.Ticket}}</td>
				<td><a href="https://{{$.Network}}.decred.org/tx/{{$data.Ticket}}" target="_blank"><span class="glyphicon glyphicon-link" aria-label="View On Block Explorer"></span></a></td>
				<td>{{ if eq $data.VoteBits 1 }}Yes{{end}}{{ if ne $data.VoteBits 1}}No{{end}}</td>
				<td>{{ $data.VoteBits }}</td>
				</tr>{{end}}
			</tbody>
			</table>
            <form method="post" class="form-inline" role="form">
				<div class="form-group">
					<label class="checkbox control-label" for="poolcontrol">Allow Pool To Have Control Of Voting: &nbsp;<span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="top" title="Allow the stake pool to determine whether a block is valid or invalid" checked></span></label>
					<label class="checkbox" for="poolcontrol">
						&nbsp;&nbsp;<input type="checkbox" name="poolcontrol" id="poolcontrol" value="1" checked>
					</label>
				</div>
	            <div id="votebits" class="form-group" style="display: none;">
                    <label class="control-label" for=""> &nbsp;Vote Bits: &nbsp;<span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="top" title="More options and their definitions will be added soon"></span></label>
                    <label class="control-label" for="chooseallow"> &nbsp;Choose:</label>
                    <select class="form-control" id="chooseallow" name="chooseallow"><option value=1>Allow All Blocks</option><option value=0>Disallow All Blocks</option></select>
                    <!--<label class="control-label" for="votebitsmanual"> &nbsp;Manual: &nbsp;
                    <input class="form-control input-sm" type="text" id="votebitsmanual" name="votebitsmanual" pattern="^0*(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{4}|[1-9][0-9]{1,3}|[0-9])$">-->
	            </div>
	            <div class="form-group">
	            	<div class="col-sm-2">
	            		 <button name="updatetickets" class="btn btn-primary">Update Tickets</button>
	            	</div>
	            </div>
            	<input type="hidden" name="{{.CsrfKey}}" value={{.CsrfToken}}>
            </form>
			{{end}}
		</div>
	</div>
</div>
<div class="panel panel-default">
	<div class="panel-heading" style="background-color: #222; color: #ffffff;">
		<h4 class="panel-title">
			<a data-toggle="collapse" data-parent="#accordion" href="#collapse-instr">Ticket Instructions</a>
		</h4>
	</div>

	<div id="collapse-instr" class="panel-collapse collapse {{if not .Tickets }}in{{end}}">
		<div class="panel-body" style="background-color: #333; color: #ffffff;">
			<p><span style="font-size: larger;">Your P2SH multisignature script for delegating votes has been generated. Please first import it locally into your wallet using <b>dcrctl</b> for safe keeping, so you can recover your funds and vote in the unlikely event of a pool failure:</span></p>

			<p><span style="font-size: larger;">dcrctl --wallet importscript "script"</span></p>
			<p><span style="font-size: larger;">For example:</span></p>
			<div class="cmd"><pre>$ dcrctl {{ if eq .Network "testnet"}}--testnet{{end}} --wallet importscript {{ .User.MultiSigScript }}</pre></div>

			<p><span style="font-size: larger;">After successfully importing the script into your wallet, you may generate tickets delegated to the pool in either of two ways:</span></p>

			<p><span style="font-size: larger;"><b>Option A</b></span></p>
			<p><span style="font-size: larger;">Start a wallet with funds available and the following flags:</span></p>
			<p><span style="font-size: larger;">--enablestakemining</span></p>
			<p><span style="font-size: larger;">--pooladdress={{ .User.UserFeeAddr }}</span></p>
			<p><span style="font-size: larger;">--poolfees={{ .PoolFees }}</span></p>
			<p><span style="font-size: larger;">--ticketaddress={{ .User.MultiSigAddress }}</span></p>
			<p><span style="font-size: larger;">Unlock the wallet and it will automatically purchase stake tickets delegated to the pool address. For more information about these flags, please go <a href="https://wiki.decred.org/Solo_Stake_Mining">here</a>.</span></p>

			<p><span style="font-size: larger;"><b>Option B</b></span></p>
			<p><span style="font-size: larger;">Start a wallet with funds available and manually purchase tickets with the following command using <b>dcrctl</b>:</span></p>
			<p><span style="font-size: larger;">dcrctl {{ if eq .Network "testnet"}}--testnet{{end}} --wallet purchaseticket "fromaccount" spendlimit minconf ticketaddress numtickets poolfeeaddress poolfeeamt</span></p>
			<div class="cmd"><pre>dcrctl {{ if eq .Network "testnet"}}--testnet{{end}} --wallet purchaseticket "default" 20 1 {{ .User.MultiSigAddress }} 1 {{ .User.UserFeeAddr }} {{ .PoolFees}}</pre></div>
			<p><span style="font-size: larger;">Will purchase a ticket delegated to the pool using the default account only if the current network price for a ticket is less than 20.0 coins.</span></p>
		</div>
	</div>
</div>
{{end}}
